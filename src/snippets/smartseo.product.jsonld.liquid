
{%- assign hasReviews = false -%}
{%- assign reviewAppDescription = blank -%}
{%- assign ratingValue = blank -%}
{%- assign reviewCount = blank -%}
{%- if product.metafields.spr.reviews != blank and hasReviews == false -%}
    {%- assign ratingValueReviewArray = product.metafields.spr.reviews | split: 'meta itemprop="ratingValue" content="' -%}
    {%- assign ratingValueArr = ratingValueReviewArray[1] |split: '"' -%}
    {%- assign reviewValue = ratingValueArr[0] -%}
    {%- assign reviewsCountStrArray = product.metafields.spr.reviews | split: 'meta itemprop="reviewCount" content="' -%}
    {%- assign reviewsCountArr = reviewsCountStrArray[1] | split: '"' -%}
    {%- assign reviewsCount = reviewsCountArr[0] -%}
    {%- unless reviewsCount == blank -%}
        {%- assign hasReviews = true -%}
        {%- assign reviewAppDescription = '"Shopify Product Reviews"' -%}
        {%- assign ratingValue = reviewValue -%}
        {%- assign reviewCount = reviewsCount -%}
    {%- endunless -%}
{%- endif -%}

{%- if product.metafields.judgeme.badge != blank and hasReviews == false %}
    {%- assign ratingValueReviewArray = product.metafields.judgeme.badge | split: "data-average-rating='" -%}
    {%- assign ratingValueArr = ratingValueReviewArray[1] |split: "'" -%}
    {%- assign reviewValue = ratingValueArr[0] -%}
    {%- assign reviewsCountStrArray = product.metafields.judgeme.badge | split: "data-number-of-reviews='" -%}
    {%- assign reviewsCountArr = reviewsCountStrArray[1] | split: "'" -%}
    {%- assign reviewsCount = reviewsCountArr[0] -%}
    {%- unless reviewsCount == '0' -%}
        {%- assign hasReviews = true -%}
        {%- assign reviewAppDescription = '"Judge.me Reviews"' -%}
        {%- assign ratingValue = reviewValue -%}
        {%- assign reviewCount = reviewsCount -%}
    {%- endunless -%}
{%- endif -%}

{%- if product.metafields.yotpo.reviews_count and product.metafields.yotpo.reviews_count != '0' and product.metafields.yotpo.reviews_count != 0 and hasReviews == false %}
        {%- assign hasReviews = true -%}
        {%- assign reviewAppDescription = '"Yotpo Reviews"' -%}
        {%- assign ratingValue = product.metafields.yotpo.reviews_average -%}
        {%- assign reviewCount = product.metafields.yotpo.reviews_count -%}
{%- elsif product.metafields.orankl.review_count and product.metafields.orankl.review_count != '0' and product.metafields.orankl.review_count != 0 and hasReviews == false %}
        {%- assign hasReviews = true -%}
        {%- assign reviewAppDescription = '"Orankl Reviews"' -%}
        {%- assign ratingValue = product.metafields.orankl.rating -%}
        {%- assign reviewCount = product.metafields.orankl.review_count -%}
{%- elsif product.metafields.loox.num_reviews and product.metafields.loox.num_reviews != '0' and product.metafields.loox.num_reviews != 0 and hasReviews == false %}
        {%- assign hasReviews = true -%}
        {%- assign reviewAppDescription = '"Loox Reviews"' -%}
        {%- assign ratingValue = product.metafields.loox.avg_rating -%}
        {%- assign reviewCount = product.metafields.loox.num_reviews -%}
{%- elsif product.metafields.ssw.count_rate and product.metafields.ssw.count_rate != '0' and product.metafields.ssw.count_rate != 0 and hasReviews == false %}
        {%- assign hasReviews = true -%}
        {%- assign reviewAppDescription = '"SocialShopWave Reviews"' -%}
        {%- assign ratingValue = product.metafields.ssw.avg_rate -%}
        {%- assign reviewCount = product.metafields.ssw.count_rate -%}
{%- elsif product.metafields.vnreviews.reviewCount and product.metafields.vnreviews.reviewCount != '0' and product.metafields.vnreviews.reviewCount != 0 and hasReviews == false %}
        {%- assign hasReviews = true -%}
        {%- assign reviewAppDescription = '"Trust Reviews"' -%}
        {%- assign ratingValue = product.metafields.vnreviews.ratingValue -%}
        {%- assign reviewCount = product.metafields.vnreviews.reviewCount -%}
{%- elsif product.metafields.stamped.reviews_count and product.metafields.stamped.reviews_count != '0' and product.metafields.stamped.reviews_count != 0 and hasReviews == false %}
        {%- assign hasReviews = true -%}
        {%- assign reviewAppDescription = '"Stamped.io Product Reviews Addon"' -%}
        {%- assign ratingValue = product.metafields.stamped.reviews_average -%}
        {%- assign reviewCount = product.metafields.stamped.reviews_count -%}
{%- endif -%}

<!--JSON-LD data generated by Smart SEO-->
<script type="application/ld+json">
    {
        "@context": "http://schema.org/",
        "@type": "Product",
        "url": "{{ shop.url | append: '/products/' | append: product.handle }}",
        "name": "{{ smartseo_title }}",
        "image": "{{ product.featured_image.src | img_url: "master" }}",
        "description": "{{ smartseo_full_description }}",
        {% if collection_urls != blank %}"category": [
            {{ collection_urls }}
        ],{%- endif -%}
        "brand": {
            "name": "{{ product.vendor | strip_newlines | strip_html | escape_once | replace: '\', '\\\\' }}"
        },
        {% if hasReviews and reviewAppDescription and ratingValue and reviewCount -%}
        "aggregateRating": {
            "@type": "AggregateRating",
            "description": {{ reviewAppDescription }},
            "ratingValue": "{{ ratingValue }}",
            "reviewCount": "{{ reviewCount }}"
        },
        {%- endif %}
        "offers" : [
            {% for variant in product.variants -%}{
                "@type" : "Offer" ,
                "priceCurrency" : "{{ shop.currency }}" ,
                "price" : "{{ variant.price | money_without_currency | split: "" | reverse | join: "" | remove_first: "00." | split: "" | reverse | join: "" | replace: ",", "" }}" ,
                "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}" ,
                "itemCondition": "http://schema.org/NewCondition",
            {%- if variant.sku != blank %}
                "sku": "{{ variant.sku }}" ,
            {%- endif %}
            {%- if variant.title != "Default Title" %}
                "name": "{{ variant.title | strip_newlines | strip_html | escape_once | replace: '\', '\\\\' }}" ,
            {%- endif -%}
                "url" : "{{ shop.url | append: variant.url }}" ,
                "seller" : {
                    "@type" : "Organization" ,
                    "name" : "{{ shop.name | strip_newlines | strip_html | escape_once | replace: '\', '\\\\' }}"
                }
            }{% unless forloop.last %}, 
            {% endunless %}{% endfor %}
        ]
    }
</script>